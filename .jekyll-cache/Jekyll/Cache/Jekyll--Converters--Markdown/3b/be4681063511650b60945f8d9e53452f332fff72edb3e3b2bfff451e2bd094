I"ˆ#<h1 id="la-partida-segunda-parte">La Partida Segunda Parte</h1>

<p>Hola! En este post seguiremos esforz√°ndonos en generar un formato de partida tal como se les exige a los contadores.</p>

<p>La tarea que dejamos la repetimos aqu√≠ para mayor comodidad y el archivo que Ud. debe usar como punto de partida tambi√©n.</p>

<p>Clique aqui para bajar el archivo <a href="/partida-3.clp">partida-3.clp</a>
Use abductor para generar contabilidad online <a href="http://abductor.necios.cl/">Abductor</a></p>

<p>Lo que se nos pide en la Tarea es bastante exigente pero, lo ayudaremos paso a paso si le parece bien.</p>

<p>Esto es lo que hay que agregarle a la partida.</p>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Cantidad que se abona al lado de la cuenta de abono</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Cantidad que se carga al lado de la cuenta de cargo</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Una l√≠nea verticial (no es necesario que sea una l√≠nea cont√≠nua, no exagere, basta usar el caracter | en cada rengl√≥n).</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />La l√≠nea vertical debe separar el lado izquierdo del lado derecho de una cuenta. As√≠ en contabilidad ellos saben que lo que se pone del lado izquierdo es el cargo y lo que se pone del lado derecho es el abono.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Un rengl√≥n m√°s abajo de todo lo anterior que tenga el cargo el s√≠mbolo | y el abono</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" checked="checked" />Otro rengl√≥n debajo de lo explicado que tenga un comentario breve: Traspaso desde cuenta x a cuenta y por un valor de tanto.</li>
</ul>

<p>Recordemos que la t√©cnica que hemos estado usando para mostrar las partidas es hacer una regla prioritaria que se dispara ante la entrada en memoria de cualquier <strong><em>facts</em></strong> <strong>partida</strong>. Eso es para que en el encabezado podamos informar al lector que estaremos dando inicio a una partida y entonces colocamos el identificador de la partida.</p>

<p>Si pensamos en t√©rminos de prioridades podemos dise√±ar un pie de partida que muestre datos de res√∫menes y otros que Ud. desee pero siempre al final de todo lo que se haya mostrado de la partida en cuesti√≥n.</p>

<p>La regla del pie de partida debe tener un prioridad menor a las regla de encabezado y a cualquier otra que se haya de disparar con relaci√≥n a la partida.</p>

<p>Entonces tenemos una estructura as√≠;</p>

<p>Partida</p>
<ol>
  <li>Encabezado</li>
  <li>Cuerpo</li>
  <li>Pie</li>
</ol>

<p>El cuerpo es variable pues corresponde al contenido de las partidas y no podemos pensar que todas las partidas sean iguales. Pero al menos podemos suponer que debe informarse de las cuentas que est√°n involucradas en la partida.</p>

<p>Todo esto ya le hemos hecho en partida-3.clp pero lo volvemos a explicar porque es importante entender c√≥mo se hace esto con reglas d de un expert system.</p>

<p>Una √∫ltima vez m√°s. Las reglas de un expert system tienen una parte sensible llamado Lado Izquiero (LHS) que har√° accionar a la regla, eso se llama <strong>fire</strong> y en castellano se acepta decir que las reglas se disparan. Entonces, usando ese lenguaje, la primera regla que se tiene que disparar es la del encabezado y la √∫ltima es la del pie.</p>

<p>Si revisamos la tarea, debemos identificar a qu√© parte de la estructura convendr√≠a asignarla cada cosa, as√≠ es f√°cil ver que los datos de abonos y cargos debieran ir en el cuerpo, as√≠ como un pedazo de l√≠nea vertical y que el resto debiera ir en el pie de partida.</p>

<p>Los tramos de l√≠nea vertical se van componiendo hasta que al final quede una l√≠nea vertical a trazos discont√≠nuos.</p>

<p>Esta es mi soluci√≥nm, √©chele un vistazo y abajo me explico.</p>

<figure class="highlight"><pre><code class="language-clips" data-lang="clips">(defrule pie
  (declare (salience 100))
  (partida (numero ?numero))
  =&gt;
  (printout t "------------------" crlf)
);


(defrule cuerpo-de-cargo
  (declare (salience 1000))
  (partida (numero ?numero))
  (cargo (cuenta ?cuenta) (partida ?numero) (monto ?monto))
  =&gt;
  (printout t tab ?monto "......|..............." ?cuenta crlf)
);


(defrule cuerpo-de-abono
  (declare (salience 1000))
  (partida (numero ?numero))
  (abono (cuenta ?cuenta) (partida ?numero) (monto ?monto))
  =&gt;
  (printout t "........... |.... " ?monto "...." ?cuenta crlf)
);</code></pre></figure>

<p>Clique aqui para bajar el archivo <a href="/partida-4.clp">partida-4.clp</a>
Use abductor para generar contabilidad online <a href="http://abductor.necios.cl/">Abductor</a></p>

<p>Ac√° ver√° que he definido dos reglas reemplazando a las anteriores que ten√≠an que ver con los cargos y los abonos. Compare los archivos partida-3.clp y partida-4-clp.</p>

<p>Tambi√©n defin√≠ una regla nueva que se llama pie, la cual solo escribre una l√≠nea.</p>

<p>Es importante notar los valors de salience en las dos reglas de cuerpo y la del pie. <em>note</em> que la regla del pie tiene una saliencia menor: <strong>100</strong>. Eso asegura que el pie nunca se imprima antes que los cuerpos.</p>

<p>El resultado es el siguiente:</p>

<figure class="highlight"><pre><code class="language-clips" data-lang="clips"> ==&gt; f-1 (partida (numero 1) (dia 1) (mes enero) (ano 2021))

==&gt; f-2 (cuenta (nombre caja) (debe 0) (haber 0))

==&gt; f-3 (abono (partida 1) (cuenta caja) (monto 100) (realizado false))

==&gt; f-4 (cuenta (nombre banco) (debe 0) (haber 0))

==&gt; f-5 (cargo (partida 1) (cuenta banco) (monto 100) (realizado false))

Partida 1

------------------

100......|...............banco

........... |.... 100....caja

------------------ </code></pre></figure>

<h2 id="an√°lisis">An√°lisis</h2>

<p>En este post hemos resuelto la forma de mostrar una partida con solo lo imprescindible:</p>

<p>Las transacciones y las cuentas en las que se desarrollan.</p>

<p>Inicialmente Ud. asserta la partida, las cuentas de la partida y las transacciones. Debe tener cuidado de que los montos de las transacciones sean iguales lado a lado. Eso es aplicar la regla de igualdad de la Contabilidad y nos permite no comprometer nuestros recursos sin que hayamos conseguiro c√≥mo financiarlos. En breve: siempre debe comprobar que la suma de cada lado por separado coincidad. TTambi√©n puede programarlo en el expert system, pero eso no es bueno pues es Ud. quien debe estar consciente de lo que haga. Es una forma de autoeducarse en finanzas o responsabilidad financiera.</p>

<p>Volviendo, en esta tarea no hemos hecho nada con las reglas de las transacciones, ellas siguen iguales, solo hemos hecho un esfuerzo  por mostrar la partida que es un conjunto de movimientos entre cuentas que tienen un sentido finaciero. El de esta tarea es un traspaso entre cuentas. La cuenta de donde se saca se carga y la que recibe el monto se abona. Este monto debe ser exactamente el mismo.</p>

<p>Haremos una mejora para mostrar el nombre de la transacci√≥n. En general se coloca ‚ÄúPor ‚Ä¶.‚Äù. Ahora lo ver√°.</p>

<p>Para ello, solo hemos de colocar un pintout en el pie.</p>

<p>Para agregar lo que hemos llamado glosa de la partida, debemos agregar un campo glosa al template partida para que se pueda usar desde el pie. Por lo que debemos modificar la regla pie para que haga un printout con ese valor.</p>

<p>No olvide agregar el contenido de la glosa cuando asserte la partida.</p>

<p>Estas son las reglas que hemos modificado</p>

<figure class="highlight"><pre><code class="language-clips" data-lang="clips">(deftemplate partida
   (slot glosa)
   (slot numero)
   (slot dia)
   (slot mes)
   (slot ano));


(defrule pie
  (declare (salience 100))
  (partida (numero ?numero) (glosa ?glosa))
  =&gt;
  (printout t "------------------" crlf)
);


(defrule inicio
  (declare (salience 10000))
  =&gt;
  ( watch facts)

  ( assert (partida  (glosa "Traspaso desde cuenta Caja a Banco por un valor de 100.")  (numero 1) (dia 1) (mes enero) (ano 2021) ))
  ( assert (cuenta (nombre caja) (debe 0)))
  ( assert (abono (partida 1) (cuenta caja) (monto 100)))

  ( assert (cuenta (nombre banco) (debe 0)))
  ( assert (cargo (partida 1) (cuenta banco) (monto 100)))

);</code></pre></figure>

<p>Este es el resultado que hemos obtenido</p>

<figure class="highlight"><pre><code class="language-clips" data-lang="clips"> Partida 1

------------------

100......|...............banco

........... |.... 100....caja

------------------

Por Traspaso desde cuenta Caja a Banco por un valor de 100. </code></pre></figure>

<p>Clique aqui para bajar el archivo <a href="/partida-5.clp">partida-5.clp</a>
Use abductor para generar contabilidad online <a href="http://abductor.necios.cl/">Abductor</a></p>

:ET